import{W as d,ba as g,d as p,e as a,g as s,j as u,q as k,s as l}from"./chunk-BN6DU3SB.js";var r=class{constructor(o,f,t,e){this.email=o,this.id=f,this._token=t,this._tokenExpiration=e}get token(){return!this._tokenExpiration||new Date>this._tokenExpiration?null:this._token}};var h={production:!1,firebaseAPIKey:"AIzaSyBVXOMLv7LJjC2vtp2KSwp7-bcJA4nUkO4"};var b=(()=>{let o=class o{constructor(t,e){this.http=t,this.router=e,this.user=new p(null)}signup(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key="+h.firebaseAPIKey,{email:t,password:e,returnSecureToken:!0}).pipe(s(this.handleError),u(i=>{this.handleAuthentication(i.email,i.localId,i.idToken,+i.expiresIn)}))}login(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key="+h.firebaseAPIKey,{email:t,password:e,returnSecureToken:!0}).pipe(s(this.handleError),u(i=>{this.handleAuthentication(i.email,i.localId,i.idToken,+i.expiresIn)}))}handleError(t){let e="An unknown error!";if(!t.error||!t.error.error)return a(t);switch(t.error.message){case"EMAIL_EXISTS":e="This email exists already!";break;case"Email_NOT_FOUND":e="This email do not exists!";break;case"INVALID_PASSWORD":e="This password is invalid!";break}return a(e)}handleAuthentication(t,e,i,c){let x=new Date(new Date().getTime()+c*1e3),m=new r(t,e,i,x);this.user.next(m),this.autoLogout(c*1e3),localStorage.setItem("userData",JSON.stringify(m))}autologin(){let t=JSON.parse(localStorage.getItem("userData"));if(!t)return;let e=new r(t.email,t.id,t._token,new Date(t._tokenExpiratorionDate));if(e.token){this.user.next(e);let i=new Date(t._tokenExpiratorionDate).getTime()-new Date().getTime();this.autoLogout(i)}}logout(){this.user.next(null),this.router.navigate(["/auth"]),localStorage.removeItem("userData"),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer),this.tokenExpirationTimer=null}autoLogout(t){this.tokenExpirationTimer=setTimeout(()=>{this.logout()},t)}};o.\u0275fac=function(e){return new(e||o)(l(d),l(g))},o.\u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"});let n=o;return n})();export{b as a};
